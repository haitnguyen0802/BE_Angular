<!-- Products Tab Content -->
<div class="dashboard__content">
  <!-- Header with search and add button -->
  <div class="products__header-actions">
    <div class="products__search">
      <input 
        type="text" 
        class="products__search-input" 
        placeholder="Search products..." 
        [(ngModel)]="searchTerm"
        (input)="searchProducts()">
    </div>
    
    <button class="products__add-btn" (click)="openAddModal()">
      <i class="fa fa-plus"></i> Add Product
    </button>
  </div>

  <!-- Products section header -->
  <div class="products__header">
    <h1 class="products__title">Products Management</h1>
    <p class="products__subtitle">Manage your product catalog</p>
  </div>
  
  <!-- Sorting options -->
  <div class="products__sort">
    <span class="products__sort-label">Sort by:</span>
    <div class="products__sort-options">
      <button 
        class="products__sort-btn" 
        [class.products__sort-btn--active]="sortField === 'product_name'"
        (click)="changeSort('product_name')">
        Name 
        <i *ngIf="sortField === 'product_name'" class="fa" 
           [ngClass]="sortDirection === 'asc' ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
      </button>
      <button 
        class="products__sort-btn" 
        [class.products__sort-btn--active]="sortField === 'price'"
        (click)="changeSort('price')">
        Price 
        <i *ngIf="sortField === 'price'" class="fa" 
           [ngClass]="sortDirection === 'asc' ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
      </button>
      <button 
        class="products__sort-btn" 
        [class.products__sort-btn--active]="sortField === 'product_code'"
        (click)="changeSort('product_code')">
        Code 
        <i *ngIf="sortField === 'product_code'" class="fa" 
           [ngClass]="sortDirection === 'asc' ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
      </button>
      <button 
        class="products__sort-btn" 
        [class.products__sort-btn--active]="sortField === 'status'"
        (click)="changeSort('status')">
        Status 
        <i *ngIf="sortField === 'status'" class="fa" 
           [ngClass]="sortDirection === 'asc' ? 'fa-arrow-up' : 'fa-arrow-down'"></i>
      </button>
    </div>
  </div>
  
  <!-- Loading Indicator -->
  <div class="products__loading" *ngIf="isLoading">
    <div class="products__loading-spinner"></div>
    <p>Loading products...</p>
  </div>
  
  <!-- Products Grid -->
  <div class="products__grid" *ngIf="!isLoading && filteredProducts.length > 0">
    <div class="product-card" *ngFor="let product of filteredProducts">
      <div class="product-card__image">
        <img [src]="product.image_url" [alt]="product.product_name" class="product-card__img">
      </div>
      <div class="product-card__content">
        <h3 class="product-card__title">{{ product.product_name }}</h3>
        <p class="product-card__code">{{ product.product_code }}</p>
        <p class="product-card__price">{{ formatPrice(product.price) }}</p>
        <div class="product-card__details">
          <p><strong>Material:</strong> {{ product.material }}</p>
          <p><strong>Size:</strong> {{ product.size }}</p>
          <p><strong>Status:</strong> <span class="product-card__status">{{ product.status }}</span></p>
        </div>
      </div>
      <div class="product-card__actions">
        <button class="product-card__btn product-card__btn--edit" (click)="openEditModal(product)">
          <i class="fa fa-edit"></i> Edit
        </button>
        <button class="product-card__btn product-card__btn--delete" (click)="openDeleteConfirm(product)">
          <i class="fa fa-trash"></i> Delete
        </button>
      </div>
    </div>
  </div>
  
  <!-- Pagination controls -->
  <div class="products__pagination" *ngIf="!isLoading && totalPages > 0">
    <button 
      class="products__pagination-btn products__pagination-btn--prev" 
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)">
      <i class="fa fa-chevron-left"></i> Previous
    </button>
    
    <div class="products__pagination-pages">
      <button 
        *ngIf="currentPage > 3 && totalPages > 5" 
        class="products__pagination-btn products__pagination-btn--page"
        (click)="goToPage(1)">
        1
      </button>
      
      <span *ngIf="currentPage > 3 && totalPages > 5" class="products__pagination-ellipsis">...</span>
      
      <button 
        *ngFor="let page of getPageNumbers()" 
        class="products__pagination-btn products__pagination-btn--page"
        [class.products__pagination-btn--active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page }}
      </button>
      
      <span *ngIf="currentPage < totalPages - 2 && totalPages > 5" class="products__pagination-ellipsis">...</span>
      
      <button 
        *ngIf="currentPage < totalPages - 2 && totalPages > 5" 
        class="products__pagination-btn products__pagination-btn--page"
        (click)="goToPage(totalPages)">
        {{ totalPages }}
      </button>
    </div>
    
    <button 
      class="products__pagination-btn products__pagination-btn--next" 
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)">
      Next <i class="fa fa-chevron-right"></i>
    </button>
    
    <div class="products__pagination-info">
      Page {{ currentPage }} of {{ totalPages }} 
      ({{ products.length }} products total)
    </div>
  </div>
  
  <!-- Empty State -->
  <div class="products__empty" *ngIf="!isLoading && filteredProducts.length === 0">
    <div class="products__empty-icon">
      <i class="fa fa-shopping-basket"></i>
    </div>
    <h3 class="products__empty-title">No products found</h3>
    <p class="products__empty-message">
      There are no products matching your search or you haven't added any products yet.
    </p>
    <button class="products__empty-btn" (click)="openAddModal()">
      <i class="fa fa-plus"></i> Add Your First Product
    </button>
  </div>
</div>

<!-- Product Form Modal -->
<div class="modal" [class.modal--active]="showModal">
  <div class="modal__backdrop" (click)="closeModal()"></div>
  <div class="modal__content">
    <div class="modal__header">
      <h2 class="modal__title">{{ isEditing ? 'Edit Product' : 'Add New Product' }}</h2>
      <button class="modal__close" (click)="closeModal()">
        <i class="fa fa-times"></i>
      </button>
    </div>
    
    <div class="modal__body">
      <form [formGroup]="productForm" (ngSubmit)="submitForm()">
        <div class="form-group">
          <label for="product_name" class="form-label">Product Name</label>
          <input 
            type="text" 
            id="product_name" 
            class="form-input" 
            formControlName="product_name"
            [class.form-input--error]="productForm.get('product_name')?.invalid && productForm.get('product_name')?.touched">
          <div class="form-error" *ngIf="productForm.get('product_name')?.invalid && productForm.get('product_name')?.touched">
            Product name is required
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group form-group--half">
            <label for="product_code" class="form-label">Product Code</label>
            <input 
              type="text" 
              id="product_code" 
              class="form-input" 
              formControlName="product_code"
              [class.form-input--error]="productForm.get('product_code')?.invalid && productForm.get('product_code')?.touched">
            <div class="form-error" *ngIf="productForm.get('product_code')?.invalid && productForm.get('product_code')?.touched">
              Product code is required
            </div>
          </div>
          
          <div class="form-group form-group--half">
            <label for="price" class="form-label">Price</label>
            <input 
              type="text" 
              id="price" 
              class="form-input" 
              formControlName="price"
              [class.form-input--error]="productForm.get('price')?.invalid && productForm.get('price')?.touched">
            <div class="form-error" *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched">
              Price is required
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group form-group--half">
            <label for="material" class="form-label">Material</label>
            <input 
              type="text" 
              id="material" 
              class="form-input" 
              formControlName="material"
              [class.form-input--error]="productForm.get('material')?.invalid && productForm.get('material')?.touched">
            <div class="form-error" *ngIf="productForm.get('material')?.invalid && productForm.get('material')?.touched">
              Material is required
            </div>
          </div>
          
          <div class="form-group form-group--half">
            <label for="size" class="form-label">Size</label>
            <input 
              type="text" 
              id="size" 
              class="form-input" 
              formControlName="size"
              [class.form-input--error]="productForm.get('size')?.invalid && productForm.get('size')?.touched">
            <div class="form-error" *ngIf="productForm.get('size')?.invalid && productForm.get('size')?.touched">
              Size is required
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="colors" class="form-label">Colors (comma separated)</label>
          <input 
            type="text" 
            id="colors" 
            class="form-input" 
            formControlName="colors"
            [class.form-input--error]="productForm.get('colors')?.invalid && productForm.get('colors')?.touched">
          <div class="form-error" *ngIf="productForm.get('colors')?.invalid && productForm.get('colors')?.touched">
            Colors are required
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group form-group--half">
            <label for="status" class="form-label">Status</label>
            <select 
              id="status" 
              class="form-select" 
              formControlName="status"
              [class.form-select--error]="productForm.get('status')?.invalid && productForm.get('status')?.touched">
              <option value="Đang Có Sẵn">Đang Có Sẵn</option>
              <option value="Hết Hàng">Hết Hàng</option>
              <option value="Sắp Ra Mắt">Sắp Ra Mắt</option>
            </select>
          </div>
          
          <div class="form-group form-group--half">
            <label for="category_id" class="form-label">Category ID</label>
            <input 
              type="number" 
              id="category_id" 
              class="form-input" 
              formControlName="category_id"
              [class.form-input--error]="productForm.get('category_id')?.invalid && productForm.get('category_id')?.touched">
            <div class="form-error" *ngIf="productForm.get('category_id')?.invalid && productForm.get('category_id')?.touched">
              Category ID is required
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="image_url" class="form-label">Image URL</label>
          <input 
            type="text" 
            id="image_url" 
            class="form-input" 
            formControlName="image_url"
            [class.form-input--error]="productForm.get('image_url')?.invalid && productForm.get('image_url')?.touched">
          <div class="form-error" *ngIf="productForm.get('image_url')?.invalid && productForm.get('image_url')?.touched">
            Image URL is required
          </div>
        </div>
        
        <div class="form-group">
          <label for="slug" class="form-label">Slug</label>
          <input 
            type="text" 
            id="slug" 
            class="form-input" 
            formControlName="slug"
            [class.form-input--error]="productForm.get('slug')?.invalid && productForm.get('slug')?.touched">
          <div class="form-error" *ngIf="productForm.get('slug')?.invalid && productForm.get('slug')?.touched">
            Slug is required
          </div>
        </div>
        
        <div class="form-group">
          <label for="description" class="form-label">Description</label>
          <textarea 
            id="description" 
            class="form-textarea" 
            formControlName="description"
            rows="4"></textarea>
        </div>
        
        <div class="modal__footer">
          <button type="button" class="modal__btn modal__btn--secondary" (click)="closeModal()">Cancel</button>
          <button type="submit" class="modal__btn modal__btn--primary" [disabled]="isLoading">
            <span *ngIf="isLoading">Saving...</span>
            <span *ngIf="!isLoading">{{ isEditing ? 'Update Product' : 'Add Product' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" [class.modal--active]="showDeleteConfirm">
  <div class="modal__backdrop" (click)="closeDeleteConfirm()"></div>
  <div class="modal__content modal__content--sm">
    <div class="modal__header">
      <h2 class="modal__title">Confirm Delete</h2>
      <button class="modal__close" (click)="closeDeleteConfirm()">
        <i class="fa fa-times"></i>
      </button>
    </div>
    
    <div class="modal__body">
      <div class="delete-confirm">
        <div class="delete-confirm__icon">
          <i class="fa fa-exclamation-triangle"></i>
        </div>
        <p class="delete-confirm__text">
          Are you sure you want to delete the product <strong>{{ selectedProduct?.product_name }}</strong>?
          This action cannot be undone.
        </p>
      </div>
    </div>
    
    <div class="modal__footer">
      <button type="button" class="modal__btn modal__btn--secondary" (click)="closeDeleteConfirm()">Cancel</button>
      <button type="button" class="modal__btn modal__btn--danger" (click)="deleteProduct()" [disabled]="isLoading">
        <span *ngIf="isLoading">Deleting...</span>
        <span *ngIf="!isLoading">Delete Product</span>
      </button>
    </div>
  </div>
</div> 